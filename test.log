===========================================
TINC QUIC TEST - Tue Nov 11 20:25:39 MSK 2025
===========================================

=== Building Docker images ===
Compose now can delegate build to bake for better performances
Just set COMPOSE_BAKE=true
#0 building with "default" instance using docker driver

#1 [node1 internal] load build definition from Dockerfile.optimized
#1 transferring dockerfile: 3.20kB done
#1 DONE 0.0s

#2 [node1 auth] library/ubuntu:pull token for registry-1.docker.io
#2 DONE 0.0s

#3 [node1 internal] load metadata for docker.io/library/ubuntu:22.04
#3 DONE 0.9s

#4 [node1 internal] load .dockerignore
#4 transferring context: 616B done
#4 DONE 0.0s

#5 [node1 tinc-builder 1/9] FROM docker.io/library/ubuntu:22.04@sha256:09506232a8004baa32c47d68f1e5c307d648fdd59f5e7eaa42aaf87914100db3
#5 DONE 0.0s

#6 [node1 internal] load build context
#6 transferring context: 1.62MB 0.4s done
#6 DONE 0.4s

#7 [node1 quiche-builder 3/6] RUN curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
#7 CACHED

#8 [node1 quiche-builder 4/6] WORKDIR /build
#8 CACHED

#9 [node1 tinc-builder 4/9] COPY --from=quiche-builder /build/deps/quiche/target/release/libquiche.so /usr/lib/
#9 CACHED

#10 [node1 quiche-builder 5/6] COPY deps/quiche /build/deps/quiche
#10 CACHED

#11 [node1 tinc-builder 3/9] WORKDIR /build
#11 CACHED

#12 [node1 quiche-builder 2/6] RUN apt-get update && apt-get install -y     build-essential     curl     git     libssl-dev     pkg-config     cmake     libclang-dev     clang     && rm -rf /var/lib/apt/lists/*
#12 CACHED

#13 [node1 tinc-builder 2/9] RUN apt-get update && apt-get install -y     build-essential     autoconf     automake     libtool     libssl-dev     zlib1g-dev     liblzo2-dev     libncurses5-dev     libreadline-dev     && rm -rf /var/lib/apt/lists/*
#13 CACHED

#14 [node1 quiche-builder 6/6] RUN cd deps/quiche &&     cargo build --release --features ffi,pkg-config-meta
#14 CACHED

#15 [node1 tinc-builder 5/9] COPY --from=quiche-builder /build/deps/quiche/quiche/include/quiche.h /usr/include/
#15 CACHED

#16 [node1 tinc-builder 6/9] RUN ldconfig
#16 CACHED

#17 [node1 tinc-builder 7/9] COPY --from=quiche-builder /build/deps/quiche /build/deps/quiche
#17 CACHED

#18 [node1 tinc-builder 8/9] COPY . /build/
#18 DONE 3.2s

#19 [node1 tinc-builder 9/9] RUN autoreconf -fsi &&     ./configure         --prefix=/usr         --sysconfdir=/etc         --localstatedir=/var         --with-openssl         --enable-maintainer-mode &&     make &&     make install
#19 1.759 sh: 1: git: not found
#19 2.028 sh: 1: git: not found
#19 2.187 sh: 1: git: not found
#19 2.288 configure.ac:17: warning: The macro `AC_PROG_CC_STDC' is obsolete.
#19 2.288 configure.ac:17: You should run autoupdate.
#19 2.288 ./lib/autoconf/c.m4:1666: AC_PROG_CC_STDC is expanded from...
#19 2.288 configure.ac:17: the top level
#19 2.403 sh: 1: git: not found
#19 2.810 configure: WARNING: unrecognized options: --enable-maintainer-mode
#19 2.831 checking for a BSD-compatible install... /usr/bin/install -c
#19 2.836 checking whether build environment is sane... yes
#19 2.842 checking for a race-free mkdir -p... /usr/bin/mkdir -p
#19 2.843 checking for gawk... no
#19 2.843 checking for mawk... mawk
#19 2.843 checking whether make sets $(MAKE)... yes
#19 2.850 checking whether make supports nested variables... yes
#19 2.854 checking whether make supports nested variables... (cached) yes
#19 2.854 checking whether make supports the include directive... yes (GNU style)
#19 2.859 checking for gcc... gcc
#19 2.876 checking whether the C compiler works... yes
#19 2.903 checking for C compiler default output file name... a.out
#19 2.903 checking for suffix of executables... 
#19 2.923 checking whether we are cross compiling... no
#19 2.943 checking for suffix of object files... o
#19 2.953 checking whether the compiler supports GNU C... yes
#19 2.962 checking whether gcc accepts -g... yes
#19 2.972 checking for gcc option to enable C11 features... none needed
#19 2.998 checking whether gcc understands -c and -o together... yes
#19 3.015 checking dependency style of gcc... gcc3
#19 3.034 checking for stdio.h... yes
#19 3.045 checking for stdlib.h... yes
#19 3.059 checking for string.h... yes
#19 3.072 checking for inttypes.h... yes
#19 3.086 checking for stdint.h... yes
#19 3.100 checking for strings.h... yes
#19 3.114 checking for sys/stat.h... yes
#19 3.127 checking for sys/types.h... yes
#19 3.142 checking for unistd.h... yes
#19 3.160 checking for wchar.h... yes
#19 3.178 checking for minix/config.h... no
#19 3.196 checking whether it is safe to define __EXTENSIONS__... yes
#19 3.214 checking whether _XOPEN_SOURCE should be defined... no
#19 3.227 checking for gcc... (cached) gcc
#19 3.242 checking whether the compiler supports GNU C... (cached) yes
#19 3.242 checking whether gcc accepts -g... (cached) yes
#19 3.242 checking for gcc option to enable C11 features... (cached) none needed
#19 3.242 checking whether gcc understands -c and -o together... (cached) yes
#19 3.242 checking dependency style of gcc... (cached) gcc3
#19 3.242 checking how to run the C preprocessor... gcc -E
#19 3.272 checking for a sed that does not truncate output... /usr/bin/sed
#19 3.275 checking whether to build with code coverage support... no
#19 3.278 checking build system type... x86_64-pc-linux-gnu
#19 3.305 checking host system type... x86_64-pc-linux-gnu
#19 3.314 checking CFLAGS for maximum warnings... -Wall
#19 3.335 checking whether C compiler accepts -DFORTIFY_SOURCE=2... yes
#19 3.344 checking whether C compiler accepts -fwrapv... yes
#19 3.354 checking whether C compiler accepts -fPIE... yes
#19 3.364 checking whether the linker accepts -pie... yes
#19 3.384 checking whether the linker accepts -Wl,-z,relro... yes
#19 3.404 checking whether the linker accepts -Wl,-z,now... yes
#19 3.423 checking for syslog.h... yes
#19 3.441 checking for sys/file.h... yes
#19 3.461 checking for sys/ioctl.h... yes
#19 3.481 checking for sys/mman.h... yes
#19 3.498 checking for sys/param.h... yes
#19 3.517 checking for sys/resource.h... yes
#19 3.536 checking for sys/socket.h... yes
#19 3.555 checking for sys/time.h... yes
#19 3.573 checking for sys/un.h... yes
#19 3.591 checking for sys/wait.h... yes
#19 3.612 checking for netdb.h... yes
#19 3.632 checking for arpa/inet.h... yes
#19 3.653 checking for dirent.h... yes
#19 3.679 checking for getopt.h... yes
#19 3.697 checking for stddef.h... yes
#19 3.715 checking for net/if.h... yes
#19 3.752 checking for net/if_types.h... no
#19 3.788 checking for net/ethernet.h... yes
#19 3.823 checking for net/if_arp.h... yes
#19 3.858 checking for netinet/in_systm.h... yes
#19 3.892 checking for netinet/in.h... yes
#19 3.926 checking for netinet/in6.h... no
#19 3.962 checking for netpacket/packet.h... yes
#19 4.000 checking for netinet/if_ether.h... yes
#19 4.039 checking for netinet/ip.h... yes
#19 4.074 checking for netinet/ip6.h... yes
#19 4.112 checking for resolv.h... yes
#19 4.149 checking for netinet/tcp.h... yes
#19 4.185 checking for netinet/ip_icmp.h... yes
#19 4.223 checking for netinet/icmp6.h... yes
#19 4.261 checking for working __malloc__ attribute... yes
#19 4.272 checking for working __nonnull__ attribute... yes
#19 4.283 checking for working __warn_unused_result__ attribute... yes
#19 4.293 checking for struct ether_header... yes
#19 4.372 checking for struct arphdr... yes
#19 4.449 checking for struct ether_arp... yes
#19 4.523 checking for struct ip... yes
#19 4.601 checking for struct icmp... yes
#19 4.677 checking for struct ip6_hdr... yes
#19 4.758 checking for struct icmp6_hdr... yes
#19 4.836 checking for struct nd_neighbor_solicit... yes
#19 4.912 checking for struct nd_opt_hdr... yes
#19 4.988 checking for asprintf... yes
#19 5.009 checking for daemon... yes
#19 5.029 checking for fchmod... yes
#19 5.049 checking for flock... yes
#19 5.071 checking for fork... yes
#19 5.094 checking for gettimeofday... yes
#19 5.114 checking for mlockall... yes
#19 5.135 checking for putenv... yes
#19 5.157 checking for recvmmsg... yes
#19 5.178 checking for strsignal... yes
#19 5.198 checking for nanosleep... yes
#19 5.219 checking for unsetenv... yes
#19 5.242 checking for vsyslog... yes
#19 5.263 checking for devname... no
#19 5.289 checking for fdevname... no
#19 5.313 checking for getopt_long... yes
#19 5.334 checking for gcc options needed to detect all undeclared functions... none needed
#19 5.357 checking whether res_init is declared... yes
#19 5.379 checking for res_init in -lresolv... no
#19 5.402 checking for linux/if_tun.h... yes
#19 5.447 checking for curses.h... yes
#19 5.470 checking for initscr in -lncurses... yes
#19 5.493 checking for wtimeout in -ltinfo... yes
#19 5.526 checking for readline/readline.h... yes
#19 5.561 checking for readline/history.h... yes
#19 5.582 checking for readline in -lreadline... yes
#19 5.604 checking for zlib.h... yes
#19 5.624 checking for compress2 in -lz... yes
#19 5.644 checking for lzo1x_1_compress in -llzo2... yes
#19 5.664 checking for lzo/lzo1x.h... yes
#19 5.685 checking for dlopen... yes
#19 5.708 checking for openssl/evp.h... yes
#19 5.746 checking for openssl/rsa.h... yes
#19 5.776 checking for openssl/rand.h... yes
#19 5.812 checking for openssl/err.h... yes
#19 5.839 checking for openssl/sha.h... yes
#19 5.862 checking for openssl/pem.h... yes
#19 5.916 checking for openssl/engine.h... yes
#19 5.969 checking for EVP_EncryptInit_ex in -lcrypto... yes
#19 6.005 checking for SSL_new in -lssl... yes
#19 6.046 checking for RAND_bytes... yes
#19 6.094 checking for EVP_EncryptInit_ex... yes
#19 6.137 checking for EVP_CIPHER_CTX_new... yes
#19 6.183 checking whether OpenSSL_add_all_algorithms is declared... yes
#19 6.217 checking whether EVP_aes_256_cfb is declared... yes
#19 6.256 checking for BN_GENCB_new... yes
#19 6.297 checking for ERR_remove_state... yes
#19 6.335 checking for RSA_set0_key... yes
#19 6.372 checking for HMAC_CTX_new... yes
#19 6.420 checking that generated files are newer than configure... done
#19 6.420 configure: creating ./config.status
#19 6.470 config.status: creating Makefile
#19 6.478 config.status: creating src/Makefile
#19 6.489 config.status: creating doc/Makefile
#19 6.499 config.status: creating test/Makefile
#19 6.510 config.status: creating test/testlib.sh
#19 6.519 config.status: creating systemd/Makefile
#19 6.528 config.status: creating bash_completion.d/Makefile
#19 6.540 config.status: creating config.h
#19 6.542 config.status: config.h is unchanged
#19 6.545 config.status: executing depfiles commands
#19 6.584 configure: WARNING: unrecognized options: --enable-maintainer-mode
#19 6.606 make  all-recursive
#19 6.607 make[1]: Entering directory '/build'
#19 6.609 Making all in src
#19 6.633 make[2]: Entering directory '/build/src'
#19 6.633   CC       address_cache.o
#19 6.751   CC       autoconnect.o
#19 6.843   CC       conf.o
#19 6.971   CC       connection.o
#19 7.066   CC       control.o
#19 7.169   CC       dummy_device.o
#19 7.244   CC       edge.o
#19 7.333   CC       event.o
#19 7.398 event.c: In function 'signal_handler':
#19 7.398 event.c:236:9: warning: ignoring return value of 'write' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 7.398   236 |         write(pipefd[1], &num, 1);
#19 7.398       |         ^~~~~~~~~~~~~~~~~~~~~~~~~
#19 7.444   CC       fd_device.o
#19 7.540   CC       graph.o
#19 7.648   CC       logger.o
#19 7.713 logger.c: In function 'real_logger':
#19 7.713 logger.c:93:25: warning: ignoring return value of 'write' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 7.713    93 |                         write(umbilical, message, strlen(message));
#19 7.713       |                         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#19 7.713 logger.c:94:25: warning: ignoring return value of 'write' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 7.713    94 |                         write(umbilical, "\n", 1);
#19 7.713       |                         ^~~~~~~~~~~~~~~~~~~~~~~~~
#19 7.744   CC       meta.o
#19 7.860   CC       multicast_device.o
#19 7.953   CC       net.o
#19 8.079   CC       net_packet.o
#19 8.394   CC       net_setup.o
#19 8.620   CC       net_socket.o
#19 8.806   CC       netutl.o
#19 8.913   CC       node.o
#19 9.029   CC       process.o
#19 9.107   CC       protocol.o
#19 9.208   CC       protocol_auth.o
#19 9.277 protocol_auth.c: In function 'receive_invitation_sptps':
#19 9.277 protocol_auth.c:296:9: warning: ignoring return value of 'fgets' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 9.277   296 |         fgets(buf, sizeof(buf), f);
#19 9.277       |         ^~~~~~~~~~~~~~~~~~~~~~~~~~
#19 9.425   CC       protocol_edge.o
#19 9.528   CC       protocol_key.o
#19 9.674   CC       protocol_misc.o
#19 9.780   CC       protocol_subnet.o
#19 9.874   CC       raw_socket_device.o
#19 9.965   CC       route.o
#19 10.20   CC       script.o
#19 10.27 script.c: In function 'environment_add':
#19 10.27 script.c:83:17: warning: ignoring return value of 'vasprintf' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 10.27    83 |                 vasprintf(&env->entries[env->n], format, ap);
#19 10.27       |                 ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#19 10.27 script.c: In function 'environment_update':
#19 10.27 script.c:96:9: warning: ignoring return value of 'vasprintf' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 10.27    96 |         vasprintf(&env->entries[pos], format, ap);
#19 10.27       |         ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#19 10.31   CC       subnet.o
#19 10.43   CC       subnet_parse.o
#19 13.10   CC       tincd.o
#19 13.18 tincd.c: In function 'main':
#19 13.18 tincd.c:396:9: warning: ignoring return value of 'chdir' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 13.18   396 |         chdir(confbase);
#19 13.18       |         ^~~~~~~~~~~~~~~
#19 13.18 tincd.c:551:17: warning: ignoring return value of 'write' declared with attribute 'warn_unused_result' [-Wunused-result]
#19 13.18   551 |                 write(umbilical, "", 1);
#19 13.18       |                 ^~~~~~~~~~~~~~~~~~~~~~~
#19 13.22   GEN      version_git.h
#19 13.23   CC       version.o
#19 13.24   CC       quic/quic.o
#19 13.27 quic/quic.c:47:21: warning: 'DEFAULT_ALPN_LEN' defined but not used [-Wunused-const-variable=]
#19 13.27    47 | static const size_t DEFAULT_ALPN_LEN = sizeof(DEFAULT_ALPN) - 1;
#19 13.27       |                     ^~~~~~~~~~~~~~~~
#19 13.36   CC       quic/quic_transport.o
#19 13.45 quic/quic_transport.c: In function 'quic_transport_handle_packet':
#19 13.45 quic/quic_transport.c:1005:21: warning: implicit declaration of function 'quic_conn_set_connection'; did you mean 'quic_conn_set_node'? [-Wimplicit-function-declaration]
#19 13.45  1005 |                     quic_conn_set_connection(qconn, c);
#19 13.45       |                     ^~~~~~~~~~~~~~~~~~~~~~~~
#19 13.45       |                     quic_conn_set_node
#19 13.64   CC       quic/quic_reality.o
#19 13.74 quic/quic_reality.c: In function 'quic_reality_proxy_data':
#19 13.74 quic/quic_reality.c:368:23: warning: 'buf' may be used uninitialized [-Wmaybe-uninitialized]
#19 13.74   368 |         ssize_t len = quic_conn_recv(client_conn, buf, sizeof(buf));
#19 13.74       |                       ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
#19 13.74 In file included from quic/quic_reality.h:24,
#19 13.74                  from quic/quic_reality.c:31:
#19 13.74 quic/quic.h:150:16: note: by argument 2 of type 'const uint8_t *' {aka 'const unsigned char *'} to 'quic_conn_recv' declared here
#19 13.74   150 | extern ssize_t quic_conn_recv(quic_conn_t *qconn, const uint8_t *buf, size_t len);
#19 13.74       |                ^~~~~~~~~~~~~~
#19 13.74 quic/quic_reality.c:367:17: note: 'buf' declared here
#19 13.74   367 |         uint8_t buf[4096];
#19 13.74       |                 ^~~
#19 13.75   CC       quic/quic_fingerprint.o
#19 13.81   CC       linux/device.o
#19 13.93   CCLD     tincd
#19 13.98 /usr/bin/ld: quic/quic_transport.o: in function `quic_transport_handle_packet':
#19 13.98 /build/src/quic/quic_transport.c:1005: undefined reference to `quic_conn_set_connection'
#19 13.98 collect2: error: ld returned 1 exit status
#19 13.98 make[2]: *** [Makefile:974: tincd] Error 1
#19 13.98 make[2]: Leaving directory '/build/src'
#19 13.99 make[1]: Leaving directory '/build'
#19 13.99 make[1]: *** [Makefile:389: all-recursive] Error 1
#19 13.99 make: *** [Makefile:330: all] Error 2
#19 ERROR: process "/bin/sh -c autoreconf -fsi &&     ./configure         --prefix=/usr         --sysconfdir=/etc         --localstatedir=/var         --with-openssl         --enable-maintainer-mode &&     make &&     make install" did not complete successfully: exit code: 2
------
 > [node1 tinc-builder 9/9] RUN autoreconf -fsi &&     ./configure         --prefix=/usr         --sysconfdir=/etc         --localstatedir=/var         --with-openssl         --enable-maintainer-mode &&     make &&     make install:
13.81   CC       linux/device.o
13.93   CCLD     tincd
13.98 /usr/bin/ld: quic/quic_transport.o: in function `quic_transport_handle_packet':
13.98 /build/src/quic/quic_transport.c:1005: undefined reference to `quic_conn_set_connection'
13.98 collect2: error: ld returned 1 exit status
13.98 make[2]: *** [Makefile:974: tincd] Error 1
13.98 make[2]: Leaving directory '/build/src'
13.99 make[1]: Leaving directory '/build'
13.99 make[1]: *** [Makefile:389: all-recursive] Error 1
13.99 make: *** [Makefile:330: all] Error 2
------
